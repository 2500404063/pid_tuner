# PID自动整定器
作者：Felix  
时间：2022.11.24  
联系：QQ 0x3338233D  
如果喜欢请给Star，谢谢~  

## 调参痛苦
每次调整PID，我都快要疯了！！！  
我必须观察智能汽车的运行情况。  
我必须观察很多波形和数值。  
我必须手动更改Kp、Ki和Kd。  
我必须稍微改变Kp、Ki、Kd（0.001）并重复更改。  
好叭，我承认，我没有那么耐心。  

不过哈哈哈，现在，所有这些都可以通过计算机完成。  
你只需要告诉它，我想要多么快的响应速度，多么稳定。  
它更容易、更快、更好。  

## 项目文件结构
1. aircraft.py：一个非线性的测试模型，具有阻力  
2. pid.py：pid的python实现  
3. pidtuner.py：PID自动整定器，关键代码都在里面  
4. test_bench.py：阶跃函数跟踪测试  
5. test_bench_nonlinear.py：连续非线性函数跟踪测试  

## 核心思想
首先我们需要明白的几点：  
1. PID的三个参数是具有各自的效果，是独立的。调节PID的参数，其实就是在调节比例，积分，微分的占比。
2. PID是没有一个绝对全局最优解的。快，准，稳这三种优化目标，是不可兼得的，要快，就会不稳，要稳，就会不快。所以我们调节PID的时候，总是在快和稳之间进行权衡。
3. Kp,Ki,Kd三个参数，在一定区间内从0开始递增的时候，PID的优化效果总是变好的，当超过一定值的时候才会变差。

所以，如果说，我们可以找到一个量，这个量能够反映PID的调节效果，我们就可以让PID自己去调节，达到我们想要的效果就停止。

观察PID的Target-Y图，我选择使用全局误差平均值的方式来衡量PID的效果。  

调节PID，本质上是调节PID的P,I,D的比例关系，所以我们总是先调节P，再调节I，再调节D  
P：跟随速度，响应速度  
I：积分比例  
D：平滑量  

## 参数解释
需要调节的参数只有这几个：
1. RangP: P优化器的效果目标区间，值越小P的效果就越明显，跟随就越紧，但是容易不稳定。
2. IncP：P参数的正向调节率，先根据你PID的输入值和PID的输出值的范围，确定调节率，再去调节RangP。IncP的值会影响RangP。这个参数其实就是`比例加速器`
3. DesP：P参数的负向调节率，这个一定要比IncP小，一般是小一个数量级
4. ConP：P参数的恒定变化率，为了避免IncP达不到目标效果
5. RangI：I优化器的目标效果
6. ConI：I优化器的恒定变化率（因为I优化器往往是比较小的，所以不需要像P参数那样有比例加速器）
7. ConD：D优化器的固定变化率，D优化器没有目标效果，因为不太好衡量，这是最后一个参数，所以通过人肉眼去观测Target-Y图就可以了，D优化器的调节难度不高。

## 评估方法
在使用PID自整定器的时候，我们需要观测以下几个值的变化：
1. Target-Y图：反应整体PID的效果，根据这个效果来确定RangP,RangI
2. AveErr：用于在大量的数据当中，选择一组能够使误差最小的PID参数，经过测试，最小可以达到1e-17。

## 优化方法
为了让PID自整定器优化更快，更加细致，一个推荐的做法是：  
让PID的输入量和PID的输出量的区间相似，换言之，最好就是让输入量和输出量都经过归一化。这样迭代次数会很少，而且很准确。